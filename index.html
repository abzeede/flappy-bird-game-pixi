<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Flappy bird</title>
    <style>
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        margin: 0;
      }
    </style>
  </head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.1/pixi.min.js"></script>
  <body>
    <script>
      let app = new PIXI.Application({
        width: window.innerWidth,
        height: window.innerHeight,
        antialias: true,
        transparent: false,
        resolution: 1
      });

      app.loader.add("flappy", "assets/flappy.png");
      app.loader.add("background", "assets/background.png");

      // renderer
      app.loader.load((loader, resources) => {
        // constant
        const BIRD_SIZE = 80;
        const BIRD_SPEED = 3;
        const BACKGROUND_SPEED = 1.5;
        const UP = -1;
        const DOWN = 1;

        // init sprite and container
        const bird = new PIXI.Sprite(resources.flappy.texture);
        const background = new PIXI.Sprite(resources.background.texture);

        // setup
        const basePosition = {
          x: app.renderer.width / 2,
          y: app.renderer.height / 2
        };
        let currentPos = { x: basePosition.x, y: basePosition.y };
        let direction = 0;
        let acceleration = 0;

        document.body.onkeyup = function(e) {
          if (e.keyCode == 32) {
            currentPos = {
              x: currentPos.x,
              y: currentPos.y - BIRD_SPEED // move up
            };
            direction = UP;
            acceleration = 3;
          }
        };

        // create background
        background.width = window.innerWidth * 1.5;
        background.height = window.innerHeight;
        app.stage.addChild(background);

        // create bird
        bird.width = BIRD_SIZE;
        bird.height = BIRD_SIZE;
        bird.anchor.x = 0.5;
        bird.anchor.y = 0.5;
        bird.position.x = currentPos.x;
        bird.position.y = currentPos.y;
        app.stage.addChild(bird);

        app.ticker.add(() => {
          if (direction === UP) {
            acceleration /= 1.1;
            bird.rotation = Math.PI / -4;
            if (acceleration < 1) {
              direction = 1;
            }
          } else if (direction === DOWN) {
            if (bird.rotation < Math.PI / 3) {
              bird.rotation += 0.08 + acceleration * 0.01;
            }
            if (acceleration <= 5) {
              acceleration *= 1.04;
            }
          }

          if (background.position.x * -1 > window.innerWidth / 2) {
            background.position.x = 0;
          } else {
            background.position.x -= BACKGROUND_SPEED;
          }

          // check bird should not go lower than screen
          if (currentPos.y <= app.renderer.height) {
            let nextPostDistant = BIRD_SPEED * direction * acceleration;
            currentPos.y += nextPostDistant;
          }

          bird.position.set(currentPos.x, currentPos.y);
        });
      });

      document.body.appendChild(app.view);
    </script>
  </body>
</html>
